<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node 版本 |  👣</title>
    <meta name="description" content="越努力越幸运，考研失败了，请勿贪玩">
    <link rel="icon" href="/look/favicon.jpg">
    
    <link rel="preload" href="/look/assets/css/0.styles.667d2b8f.css" as="style"><link rel="preload" href="/look/assets/js/app.b2ccb0bc.js" as="script"><link rel="preload" href="/look/assets/js/31.621d74fe.js" as="script"><link rel="prefetch" href="/look/assets/js/10.b471e18e.js"><link rel="prefetch" href="/look/assets/js/11.142b1017.js"><link rel="prefetch" href="/look/assets/js/12.38c12c1a.js"><link rel="prefetch" href="/look/assets/js/13.3752826a.js"><link rel="prefetch" href="/look/assets/js/14.6851574f.js"><link rel="prefetch" href="/look/assets/js/15.be40f810.js"><link rel="prefetch" href="/look/assets/js/16.3056c1b7.js"><link rel="prefetch" href="/look/assets/js/17.57430dd8.js"><link rel="prefetch" href="/look/assets/js/18.533f521c.js"><link rel="prefetch" href="/look/assets/js/19.89c42762.js"><link rel="prefetch" href="/look/assets/js/2.57f770e0.js"><link rel="prefetch" href="/look/assets/js/20.3639913f.js"><link rel="prefetch" href="/look/assets/js/21.fcca079c.js"><link rel="prefetch" href="/look/assets/js/22.2e3b1bd5.js"><link rel="prefetch" href="/look/assets/js/23.5f1efc98.js"><link rel="prefetch" href="/look/assets/js/24.4a510e86.js"><link rel="prefetch" href="/look/assets/js/25.a63093ec.js"><link rel="prefetch" href="/look/assets/js/26.f4aafbef.js"><link rel="prefetch" href="/look/assets/js/27.c482ae88.js"><link rel="prefetch" href="/look/assets/js/28.1cb9f9b1.js"><link rel="prefetch" href="/look/assets/js/29.91278398.js"><link rel="prefetch" href="/look/assets/js/3.f56078e6.js"><link rel="prefetch" href="/look/assets/js/30.f9b1e228.js"><link rel="prefetch" href="/look/assets/js/32.b73bab9d.js"><link rel="prefetch" href="/look/assets/js/33.f976c3bd.js"><link rel="prefetch" href="/look/assets/js/34.b8fd7e9b.js"><link rel="prefetch" href="/look/assets/js/35.b3b0b225.js"><link rel="prefetch" href="/look/assets/js/36.25d3b6f4.js"><link rel="prefetch" href="/look/assets/js/37.0d0a19fe.js"><link rel="prefetch" href="/look/assets/js/38.1344bf3b.js"><link rel="prefetch" href="/look/assets/js/39.95cdce16.js"><link rel="prefetch" href="/look/assets/js/4.0590639b.js"><link rel="prefetch" href="/look/assets/js/40.aa321c9e.js"><link rel="prefetch" href="/look/assets/js/41.0cffb016.js"><link rel="prefetch" href="/look/assets/js/42.fe3b4060.js"><link rel="prefetch" href="/look/assets/js/43.f400a076.js"><link rel="prefetch" href="/look/assets/js/44.1df23907.js"><link rel="prefetch" href="/look/assets/js/45.57f4b13e.js"><link rel="prefetch" href="/look/assets/js/46.8074bf51.js"><link rel="prefetch" href="/look/assets/js/47.ba79660f.js"><link rel="prefetch" href="/look/assets/js/5.7c0857a5.js"><link rel="prefetch" href="/look/assets/js/6.69989f0b.js"><link rel="prefetch" href="/look/assets/js/7.1a5c9794.js"><link rel="prefetch" href="/look/assets/js/8.14f7555d.js"><link rel="prefetch" href="/look/assets/js/9.d3587b59.js">
    <link rel="stylesheet" href="/look/assets/css/0.styles.667d2b8f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/look/" class="home-link router-link-active"><!----> <span class="site-name"> 👣</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/look/" class="nav-link">首页</a></div><div class="nav-item"><a href="/look/blog/" class="nav-link">博客</a></div><div class="nav-item"><a href="/look/stack/" class="nav-link">技术栈</a></div><div class="nav-item"><a href="/look/pc/" class="nav-link router-link-active">PC端</a></div><div class="nav-item"><a href="/look/mobile/" class="nav-link">移动端</a></div><div class="nav-item"><a href="/look/mini/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/look/uni/" class="nav-link">多端统一</a></div><div class="nav-item"><a href="/look/work/" class="nav-link">工作总结</a></div><div class="nav-item"><a href="/look/tool/" class="nav-link">效率工具</a></div><div class="nav-item"><a href="/look/devops/" class="nav-link">运维</a></div> <a href="https://github.com/841660202/look" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/look/" class="nav-link">首页</a></div><div class="nav-item"><a href="/look/blog/" class="nav-link">博客</a></div><div class="nav-item"><a href="/look/stack/" class="nav-link">技术栈</a></div><div class="nav-item"><a href="/look/pc/" class="nav-link router-link-active">PC端</a></div><div class="nav-item"><a href="/look/mobile/" class="nav-link">移动端</a></div><div class="nav-item"><a href="/look/mini/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/look/uni/" class="nav-link">多端统一</a></div><div class="nav-item"><a href="/look/work/" class="nav-link">工作总结</a></div><div class="nav-item"><a href="/look/tool/" class="nav-link">效率工具</a></div><div class="nav-item"><a href="/look/devops/" class="nav-link">运维</a></div> <a href="https://github.com/841660202/look" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>PC端</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/look/pc/react/1.html" class="active sidebar-link">react</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#node-版本" class="sidebar-link">node 版本</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#没升级前版本" class="sidebar-link">没升级前版本</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#升级后" class="sidebar-link">升级后</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#yarn" class="sidebar-link">yarn</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#查看电脑上全局npm包" class="sidebar-link">查看电脑上全局npm包</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#升级yarn" class="sidebar-link">升级yarn</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#如何写更少的reducer" class="sidebar-link">如何写更少的reducer</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#yarn用不起来是怎么回事？" class="sidebar-link">yarn用不起来是怎么回事？</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#什么时候看看react源码？" class="sidebar-link">什么时候看看react源码？</a></li><li class="sidebar-sub-header"><a href="/look/pc/react/1.html#技术栈" class="sidebar-link">技术栈</a></li></ul></li><li><a href="/look/pc/react/mockjs.html" class="sidebar-link">模拟数据</a></li><li><a href="/look/pc/print/lodop.html" class="sidebar-link">打印</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p>#node</p> <h2 id="node-版本"><a href="#node-版本" class="header-anchor">#</a> node 版本</h2> <div class="language- extra-class"><pre class="language-text"><code>
Node 升级

node有一个模块叫n（这名字可够短的。。。），是专门用来管理node.js的版本的。
首先安装n模块：
npm install -g n
第二步：
升级node.js到最新稳定版
n stable
是不是很简单？！
n后面也可以跟随版本号比如：
n v0.10.26
或
n 0.10.26
就这么简单。
另外分享几个npm的常用命令
 npm -v          #显示版本，检查npm 是否正确安装。  
 npm install express   #安装express模块  
 npm install -g express  #全局安装express模块  
 npm list         #列出已安装模块  
 npm show express     #显示模块详情  
 npm update        #升级当前目录下的项目的所有模块  
 npm update express    #升级当前目录下的项目的指定模块  
 npm update -g express  #升级全局安装的express模块  
 npm uninstall express  #删除指定的模块



</code></pre></div><h2 id="没升级前版本"><a href="#没升级前版本" class="header-anchor">#</a> 没升级前版本</h2> <div class="language- extra-class"><pre class="language-text"><code>chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ node -v
v8.9.1
chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ npm -v
5.5.1
chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ 

</code></pre></div><h2 id="升级后"><a href="#升级后" class="header-anchor">#</a> 升级后</h2> <div class="language- extra-class"><pre class="language-text"><code>chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ node -v
v10.16.0
chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ npm -v
5.5.1
chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ yarn -v
1.15.2
chenhailong@chenhailongdeMacBook-Pro:~/development/umi/peoject$ 

</code></pre></div><h2 id="yarn"><a href="#yarn" class="header-anchor">#</a> yarn</h2> <p><a href="https://yarnpkg.com/zh-Hans/docs/install#mac-stable" target="_blank" rel="noopener noreferrer">yarn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>升级前</p> <div class="language- extra-class"><pre class="language-text"><code>chenhailong@chenhailongdeMacBook-Pro:~$ yarn --version
1.15.2
chenhailong@chenhailongdeMacBook-Pro:~$ 

</code></pre></div><h2 id="查看电脑上全局npm包"><a href="#查看电脑上全局npm包" class="header-anchor">#</a> 查看电脑上全局npm包</h2> <div class="language- extra-class"><pre class="language-text"><code>chenhailong@chenhailongdeMacBook-Pro:~$ cnpm list -g --depth 0
npm WARN npm npm does not support Node.js v10.16.0
npm WARN npm You should probably upgrade to a newer version of node as we
npm WARN npm can't make any promises that npm will work with this version.
npm WARN npm Supported releases of Node.js are the latest release of 4, 6, 7, 8.
npm WARN npm You can find the latest version at https://nodejs.org/
npm WARN npm npm does not support Node.js v10.16.0
npm WARN npm You should probably upgrade to a newer version of node as we
npm WARN npm can't make any promises that npm will work with this version.
npm WARN npm Supported releases of Node.js are the latest release of 4, 6, 7, 8, 9.
npm WARN npm You can find the latest version at https://nodejs.org/
/usr/local/lib
├── @angular/cli@7.0.2
├── ant-design-pro-cli@0.2.5
├── appcenter-cli@1.0.16
├── babel-cli@6.26.0
├── cnpm@5.2.0
├── code-push-cli@2.1.8
├── code-push-server@0.2.20
├── cordova@8.0.0
├── create-react-app@1.5.2
├── create-react-native-app@1.0.0
├── damo-cli@0.0.10
├── dva-cli@0.9.2
├── dva-native-cli@0.0.8
├── exp@55.0.5
├── express-generator@4.16.0
├── flow-bin@0.67.1
├── forever@0.15.3
├── gitbook-cli@2.3.2
├── grunt@1.0.1
├── hexo-cli@1.1.0
├── ice-devtools@2.0.1
├── ionic@3.9.2
├── ios-deploy@1.9.2
├── ios-sim@6.1.2
├── n@4.1.0
├── npm@5.5.1
├── react-native-cli@2.0.1
├── react-native-git-upgrade@0.2.7
├── react-native-update-cli@0.1.0
├── rnpm@1.9.0
├──  error: ENOENT: no such file or directory, open '/usr/local/lib/node_modules/roadhog-api-doc/package.json
├── supervisor@0.12.0
├──  error: ENOENT: no such file or directory, open '/usr/local/lib/node_modules/tsd/package.json
├── tyarn@0.1.0
├── typescript@3.0.1
├── vue-cli@2.9.6
├── webpack@4.14.0
├── webpack-cli@3.0.8
├── webpack-dev-server@3.1.4
├── wepy-cli@1.7.3
└── yarn@1.15.2

</code></pre></div><h2 id="升级yarn"><a href="#升级yarn" class="header-anchor">#</a> 升级yarn</h2> <div class="language- extra-class"><pre class="language-text"><code>cnpm install -g yarn
#chenhailong@chenhailongdeMacBook-Pro:~$ yarn -v
#1.16.0
#chenhailong@chenhailongdeMacBook-Pro:~$ 
</code></pre></div><h2 id="如何写更少的reducer"><a href="#如何写更少的reducer" class="header-anchor">#</a> 如何写更少的reducer</h2> <h2 id="yarn用不起来是怎么回事？"><a href="#yarn用不起来是怎么回事？" class="header-anchor">#</a> yarn用不起来是怎么回事？</h2> <h2 id="什么时候看看react源码？"><a href="#什么时候看看react源码？" class="header-anchor">#</a> 什么时候看看react源码？</h2> <h2 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h2> <h3 id="基本"><a href="#基本" class="header-anchor">#</a> 基本</h3> <p>es6+
react
react-router redux
<a href="http://nodejs.cn/" target="_blank" rel="noopener noreferrer">nodejs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="code.aliyun.com">dva</a>
易学易用
仅有 6 个 api，对 redux 用户尤其友好，配合 umi 使用后更是降低为 0 API</p> <p>elm 概念
通过 reducers, effects 和 subscriptions 组织 model，简化 redux 和 redux-saga 引入的概念</p> <p>插件机制
比如 dva-loading 可以自动处理 loading 状态，不用一遍遍地写 showLoading 和 hideLoading</p> <h3 id="ui组件"><a href="#ui组件" class="header-anchor">#</a> ui组件</h3> <p><a href>ant design</a></p> <h3 id="脚手架"><a href="#脚手架" class="header-anchor">#</a> 脚手架</h3> <p><a href>ant design pro</a> <a href>umijs</a></p> <h3 id="样式"><a href="#样式" class="header-anchor">#</a> 样式</h3> <p><a href="http://lesscss.cn/" target="_blank" rel="noopener noreferrer">less<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h3> <p><a href="http://npm.taobao.org/" target="_blank" rel="noopener noreferrer">cnpm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href>npm</a> <a href="https://yarn.bootcss.com/" target="_blank" rel="noopener noreferrer">yarn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="mock数据"><a href="#mock数据" class="header-anchor">#</a> mock数据</h3> <p><a href="http://mockjs.com/" target="_blank" rel="noopener noreferrer">mockjs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="数据可视化"><a href="#数据可视化" class="header-anchor">#</a> 数据可视化</h3> <p><a href="https://echarts.baidu.com/" target="_blank" rel="noopener noreferrer">echarts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_1-1-1-3"><a href="#_1-1-1-3" class="header-anchor">#</a> 1+1+1&lt;-3</h3> <p>发布遇到，为什么是1+1+1&lt;-3,一个前端+一个运维+一个后端效率达到-3倍，
反思：</p> <ul><li>1、信息沟通不及时，
之前项目，运维在nginx处理时候没对location /api进行反向代理，突然就加上了，说是其他公司找他做运维出现问题，为了统一就加上了，这件事前端不知道，后端也不知道</li> <li>2、后端对spring boot不熟悉
针对1，我在后端加了​server.servlet.context-path=/api，之后应该是上下文环境的不一致，导致登陆时候存储session，后面对请求进行鉴权（这里没这么高端大气，原因没用好的jar包管理，就此打住，可补shiro）
这也是我的原因，因为spring boot只能​server.servlet.context-path，server.servlet-path被弃用，
解决：整了一个下午，作为前端，我将webpack的proxy试了个遍，只有在2和前端配置</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  &quot;/api&quot;: {
      target: &quot;https://xxxxx.com&quot;,
      changeOrigin: true,
    },
</code></pre></div><p>现象只有登陆和没加session校验的接口，才可以正常访问（现提供另一解决方案：使用token，而不用session）</p> <blockquote><p>无奈加班。。。。
下班瞎扯的影响思路，“下班没事的先回去吧” 。。。。。 项目组人走光了，静下心来慢慢整。
前端 ： 呼叫运维，“你的nginx配置是否配置了 location /api 进行反向代理没配置的配置下”，
运维： “我配置了”
前端：“那你将我的 /api/xx接口 代理到 /xx接口 ”
运维： “这个我以前试了，因为k8s的问题我改不了，只能这样，我将接口直接原样不动给后端了，要不你看看怎么解决”
结束
还好业余我搞过nginx，也玩过spring boot很久，整理好前端 排除前端、运维的情况、拉后端改后端
运行不起来，无语了，我是跟你后端说如何配置logback，可你这么干有点坑了吧，将日志配置到/opt/logs/assets-manage-error.log
删掉，我电脑是不允许写日志的，你乱配置，以后电脑岂不是装了满满的垃圾。要配置配置到项目根目录好查也好删除
运行起来
之所以写Spring boot 的配置 server.servlet.context-path=/api，是因为以前有印象
现在再查发现server.servlet.context-path 与server.servlet-path有区别，但是没办法，试下将/api补到每个userController中，将后端推到测试环境，发布测试环境，测试可以，然后试下本地，也可以。
现在是我一般使用本地后端进行调试，这样我可以打后端断点，查看后端接口是否有问题进行快速联调，
有的组员是远程连接测试环境进行调的，所以我需要在request工具中进行配置</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> extend <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi-request'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> notification <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> local <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// true 本地后端 false 开发(测试)环境</span>

<span class="token keyword">interface</span> <span class="token class-name">ResponseError</span><span class="token operator">&lt;</span><span class="token constant">D</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">;</span>
  response<span class="token punctuation">:</span> Response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> codeMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">200</span><span class="token punctuation">:</span> <span class="token string">'服务器成功返回请求的数据。'</span><span class="token punctuation">,</span>
  <span class="token number">201</span><span class="token punctuation">:</span> <span class="token string">'新建或修改数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">202</span><span class="token punctuation">:</span> <span class="token string">'一个请求已经进入后台排队（异步任务）。'</span><span class="token punctuation">,</span>
  <span class="token number">204</span><span class="token punctuation">:</span> <span class="token string">'删除数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">400</span><span class="token punctuation">:</span> <span class="token string">'发出的请求有错误，服务器没有进行新建或修改数据的操作。'</span><span class="token punctuation">,</span>
  <span class="token number">401</span><span class="token punctuation">:</span> <span class="token string">'用户没有权限（令牌、用户名、密码错误）。'</span><span class="token punctuation">,</span>
  <span class="token number">403</span><span class="token punctuation">:</span> <span class="token string">'用户得到授权，但是访问是被禁止的。'</span><span class="token punctuation">,</span>
  <span class="token number">404</span><span class="token punctuation">:</span> <span class="token string">'发出的请求针对的是不存在的记录，服务器没有进行操作。'</span><span class="token punctuation">,</span>
  <span class="token number">406</span><span class="token punctuation">:</span> <span class="token string">'请求的格式不可得。'</span><span class="token punctuation">,</span>
  <span class="token number">410</span><span class="token punctuation">:</span> <span class="token string">'请求的资源被永久删除，且不会再得到的。'</span><span class="token punctuation">,</span>
  <span class="token number">422</span><span class="token punctuation">:</span> <span class="token string">'当创建一个对象时，发生一个验证错误。'</span><span class="token punctuation">,</span>
  <span class="token number">500</span><span class="token punctuation">:</span> <span class="token string">'服务器发生错误，请检查服务器。'</span><span class="token punctuation">,</span>
  <span class="token number">502</span><span class="token punctuation">:</span> <span class="token string">'网关错误。'</span><span class="token punctuation">,</span>
  <span class="token number">503</span><span class="token punctuation">:</span> <span class="token string">'服务不可用，服务器暂时过载或维护。'</span><span class="token punctuation">,</span>
  <span class="token number">504</span><span class="token punctuation">:</span> <span class="token string">'网关超时。'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 异常处理程序
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">:</span> ResponseError</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> response <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Response <span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">;</span>
  <span class="token keyword">const</span> errortext <span class="token operator">=</span> codeMessage<span class="token punctuation">[</span>response<span class="token punctuation">.</span>status<span class="token punctuation">]</span> <span class="token operator">||</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>

  notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// message: `请求错误 ${status}: ${url}`,</span>
    message<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求错误 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> errortext<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  errorHandler<span class="token punctuation">,</span> <span class="token comment">// 默认错误处理</span>
  credentials<span class="token punctuation">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token comment">// 默认请求是否带上cookie</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sendOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>method <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'post'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sendOptions<span class="token punctuation">.</span>data <span class="token operator">=</span> options<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> sendOptions<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// url: `/${process.env.NODE_ENV === 'development' ? 'test/api' : ''}/v1${url}`,</span>
      url<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>local <span class="token operator">?</span> <span class="token string">'local'</span><span class="token punctuation">:</span> <span class="token string">'localTest'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">:</span> <span class="token string">'/api'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/v1</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>sendOptions<span class="token punctuation">,</span> interceptors<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// @ts-ignore</span>
request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'000001'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token punctuation">:</span> data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// @ts-ignore</span>
      window<span class="token punctuation">.</span>location <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token string">'000000'</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token punctuation">:</span> data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request<span class="token punctuation">;</span>


</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> proxy: {
    '/local/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
      pathRewrite: { '^/local/api': '/api' },
    },
    '/localTest/api': {
      target: 'https://xxxxx.com',
      changeOrigin: true,
      pathRewrite: { '^/localTest/api': '/api' },
    },
    &quot;/api&quot;: {
      target: &quot;https://xxxxx.com&quot;,
      changeOrigin: true,
    },
  },

</code></pre></div><p>顺便解决组员将ts编译的js .map.js也提交的问题处理了下
。。。。。20:00下班
昨天的事，今天没起床就在反思，上班来到记录下</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/look/pc/react/mockjs.html">
          模拟数据
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/look/assets/js/app.b2ccb0bc.js" defer></script><script src="/look/assets/js/31.621d74fe.js" defer></script>
  </body>
</html>
